# Lounge Hue Switch â€” Scene Cycle + dimming

- id: '1763294657209'
  alias: Lounge Switch
  description: Cycle scenes on bottom button, dim with middle buttons
  triggers:
    - trigger: event
      event_type: hue_event
      event_data:
        device_id: 8110fb5d28433b9a8fea072d30876c64
  variables:
    lounge_scene_entities: "{{ state_attr('input_select.scene_cycle_lounge', 'options') or [] }}"
    lounge_current: "{{ states('input_select.scene_cycle_lounge') }}"
    lounge_index: >
      {% set list = lounge_scene_entities %}
      {% if lounge_current in list %} {{ list.index(lounge_current) }} {% else %} 0 {% endif %}
    lounge_next_index: >
      {% set list = lounge_scene_entities %}
      {% set length = list|length %}
      {% if length == 0 %} 0 {% else %} {{ (lounge_index|int + 1) % length }} {% endif %}
    lounge_next_entity: "{{ lounge_scene_entities[lounge_next_index|int] }}"
  actions:
    - choose:
        - alias: Button 1 - Short Release (Cycle Living Scenes)
          conditions:
            - condition: template
              value_template: >
                {{ trigger.event.data.type == 'short_release' and trigger.event.data.subtype == 1 }}
          sequence:
            - action: scene.turn_on
              target:
                entity_id: "{{ living_next_entity }}"
            - action: input_select.select_option
              target:
                entity_id: input_select.scene_cycle_living_room
              data:
                option: "{{ living_next_entity }}"

        - alias: Button 1 - Long Release (living off)
          conditions:
            - condition: template
              value_template: >
                {{ trigger.event.data.type == 'long_release' and trigger.event.data.subtype == 1 }}
          sequence:
            - action: light.turn_off
              target:
                entity_id: light.living_room
              data:
                transition: 5

        - alias: Button 2 - Short Release (Brightness Up)
          conditions:
            - condition: template
              value_template: >
                {{ trigger.event.data.type == 'short_release' and trigger.event.data.subtype == 2 }}
          sequence:
            - action: light.turn_on
              data:
                brightness_step_pct: 20
              target:
                entity_id: light.living_room

        - alias: Button 3 - Short Release (Brightness Down)
          conditions:
            - condition: template
              value_template: >
                {{ trigger.event.data.type == 'short_release' and trigger.event.data.subtype == 3 }}
          sequence:
            - action: light.turn_on
              data:
                brightness_step_pct: -20
              target:
                entity_id: light.living_room

        - alias: Button 4 - Short Release (Cycle Lounge Scenes)
          conditions:
            - condition: template
              value_template: >
                {{ trigger.event.data.type == 'initial_press' and trigger.event.data.subtype == 4 }}
          sequence:
            - action: scene.turn_on
              target:
                entity_id: "{{ lounge_next_entity }}"
            - action: input_select.select_option
              target:
                entity_id: input_select.scene_cycle_lounge
              data:
                option: "{{ lounge_next_entity }}"

        - alias: Button 4 - Long Release (Lounge Off)
          conditions:
            - condition: template
              value_template: >
                {{ trigger.event.data.type == 'long_release' and trigger.event.data.subtype == 4 }}
          sequence:
            - action: light.turn_off
              target:
                entity_id: light.lounge
              data:
                transition: 5
  mode: single
